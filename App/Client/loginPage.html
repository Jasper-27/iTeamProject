<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>New Wiki Design</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	
	    	<!-- Links for the style sheets Colour -->
	<link rel="stylesheet" href="assets/css/colour/light/styles-Colour.css">
	
	    	<!-- Links for the style sheets Layout -->
	<link rel="stylesheet" href="assets/css/layout/normal/styles.css">
	

</head>

<body>
    <nav class="navbar navbar-light navbar-expand-md">
        <div class="container-fluid"><a class="navbar-brand" href="index.html">WinkiMessenger</a><button data-toggle="collapse" class="navbar-toggler" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navcol-1">
                <ul class="nav navbar-nav">
                    <li class="nav-item"><a class="nav-link " href="index.html">home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="loginPage.html">Login</a></li>
                </ul>
            </div>        
        </div> 
    </nav>


    <section class="login-clean" >

        <div class="login-clean"  style="width: 35%; margin: auto;">
            <h2 class="sr-only">Login Form</h2>

            <div id="credentials" class="illustration"><img src="logo.png" height="220"></div>
            <div class="form-group"><input class="form-control" type="text" id="user" placeholder="Username" name="username"></div>
            <div class="form-group"><input class="form-control" type="password" id="pass" name="password" placeholder="Password"></div>

            <div class="form-group"><button class="btn btn-primary btn-block"  onclick="login()" style="background: var(--right-msg-bg);">Log In</button></div>
        </div>
                
    </section>   


    <script>

        let API = "http://localhost:8080/login/"

            
        // Posts the user details to the server so the server can check them 
        function login(){
            console.log("user " + document.getElementById("user").value)
            console.log("password " + document.getElementById("user").value)

            // POSTs the username and password to the server
            var xhr = new XMLHttpRequest();
            xhr.open("POST", API, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({
                "username" : document.getElementById("user").value, 
                "password" : document.getElementById("pass").value
            }));    

            // handles the response from the POST request
            xhr.onload = function() {
                console.log(this.responseText);
                var data = JSON.parse(this.responseText);

                if (data.message === "Authentication success"){
                    sessionStorage.setItem('token', data.token) // set's the token in session storage 
                    sessionStorage.setItem('username',  document.getElementById("user").value)
                    console.log("Login success")
                    window.location.replace("./app.html"); //changes to the main app window 
                }else{
                    alert("Login failed")
                }
            }
        }
    </script>


    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>


</body>
</html>